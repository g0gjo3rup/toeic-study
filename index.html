<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOEIC 30å¤©å¯¦æˆ°ç‰¹è¨“ (PROç‰ˆ)</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #27ae60;
            --wrong: #e74c3c;
            --bg: #f3f4f6;
            --text: #333;
            --card-bg: #ffffff;
        }
        body { font-family: "Segoe UI", "Microsoft JhengHei", sans-serif; background: var(--bg); color: var(--text); padding: 20px; line-height: 1.6; margin: 0; }
        .container { max-width: 800px; margin: 0 auto; background: var(--card-bg); padding: 30px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); }
        h1 { color: var(--primary); text-align: center; border-bottom: 3px solid var(--accent); padding-bottom: 15px; margin-bottom: 25px; font-size: 1.8em; }
        
        /* é ç±¤åˆ‡æ› */
        .tabs { display: flex; background: #eee; padding: 5px; border-radius: 8px; margin-bottom: 20px; }
        .tab { flex: 1; text-align: center; padding: 12px; cursor: pointer; font-weight: bold; color: #666; border-radius: 6px; transition: 0.3s; }
        .tab.active { background: white; color: var(--primary); shadow: 0 2px 5px rgba(0,0,0,0.1); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .view-section { display: none; animation: fadeIn 0.3s ease; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* æ§åˆ¶å€ */
        .controls { background: #eef2f5; padding: 20px; border-radius: 10px; display: flex; flex-wrap: wrap; gap: 15px; justify-content: space-between; align-items: center; margin-bottom: 25px; border: 1px solid #dee2e6; }
        select { padding: 10px 15px; font-size: 16px; border-radius: 6px; border: 1px solid #ccc; cursor: pointer; background: white; min-width: 200px; }
        button { padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-size: 15px; font-weight: bold; transition: 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #34495e; transform: translateY(-1px); }
        .btn-accent { background: var(--accent); color: white; }
        .btn-accent:hover { background: #219150; transform: translateY(-1px); }

        /* å–®å­—åˆ—è¡¨ */
        .word-list { list-style: none; padding: 0; }
        .word-item { padding: 20px; border-bottom: 1px solid #eee; position: relative; transition: 0.2s; border-radius: 8px; }
        .word-item:hover { background: #f8f9fa; }
        
        .word-header { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; margin-bottom: 6px; }
        .index-num { color: #aaa; font-weight: bold; font-size: 0.9em; min-width: 20px; }
        .en-word { font-size: 1.5em; font-weight: 700; color: var(--primary); }
        
        .pos-tag { background: #e0e0e0; color: #555; padding: 2px 8px; border-radius: 4px; font-size: 0.8em; font-weight: bold; font-family: monospace; }
        .ch-meaning { color: #c0392b; font-weight: bold; font-size: 1.1em; margin-left: 5px; }

        /* æ˜Ÿæ˜Ÿèˆ‡ç™¼éŸ³æ¨£å¼ */
        .stars { color: #f1c40f; font-size: 1.1em; letter-spacing: 2px; margin: 0 5px; }
        .btn-audio {
            background: white; border: 1px solid #ddd; border-radius: 50%;
            width: 26px; height: 26px; cursor: pointer;
            display: inline-flex; align-items: center; justify-content: center;
            color: #555; margin-left: 5px; transition: 0.2s;
        }
        .btn-audio:hover { background: var(--primary); color: white; border-color: var(--primary); }

        /* æ–°å¢ï¼šåŒç¾©å­—/è¡ç”Ÿå­—å€å¡Š */
        .word-rel {
            font-size: 0.85em;
            color: #666;
            background-color: #f1f2f6;
            padding: 4px 10px;
            border-radius: 4px;
            margin-bottom: 8px;
            display: inline-block;
            border-left: 3px solid #bdc3c7;
        }
        
        .sentence-box { background: #fafafa; border: 1px dashed #ccc; padding: 10px; margin-top: 5px; font-size: 0.95em; color: #555; border-radius: 6px; }
        .en-sent { display: block; margin-bottom: 4px; font-weight: 500; color: #2c3e50; }
        
        /* æ¸¬é©—å€æ¨£å¼ */
        .quiz-card { background: #fff; padding: 25px; margin-bottom: 25px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border: 1px solid #eee; position: relative; overflow: hidden; }
        .quiz-tag { position: absolute; top: 0; right: 0; background: var(--primary); color: white; padding: 5px 15px; font-size: 0.8em; border-bottom-left-radius: 8px; font-weight: bold; }
        .quiz-question { font-size: 1.25em; font-weight: 600; margin-bottom: 20px; color: #2c3e50; line-height: 1.5; }
        .quiz-options { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .option-btn { background: white; border: 2px solid #e0e0e0; padding: 15px; text-align: left; cursor: pointer; border-radius: 8px; transition: all 0.2s; font-size: 1em; display: flex; align-items: center; }
        .option-btn:hover { border-color: var(--accent); background: #f0fdf4; transform: translateX(5px); }
        .option-btn.selected { background: var(--primary); color: white; border-color: var(--primary); }
        .option-marker { display: inline-block; width: 25px; font-weight: bold; color: #999; }
        .selected .option-marker { color: white; }

        /* çµæœå€ */
        .result-stats { display: flex; gap: 20px; margin-bottom: 20px; }
        .stat-card { flex: 1; background: #f8f9fa; padding: 15px; text-align: center; border-radius: 8px; border: 1px solid #dee2e6; }
        .stat-num { font-size: 2em; font-weight: bold; color: var(--primary); }
        
        .result-item { margin-bottom: 15px; padding: 20px; border-radius: 8px; border: 1px solid #eee; background: white; }
        .result-item.correct { border-left: 6px solid var(--accent); }
        .result-item.wrong { border-left: 6px solid var(--wrong); }
        
        .answer-row { display: flex; justify-content: space-between; margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 6px; }
        .explanation { font-size: 0.95em; color: #555; margin-top: 10px; line-height: 1.6; }

        /* åŒ¯å…¥è¦–çª— */
        #importModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 999; }
        .modal-content { background: white; padding: 30px; width: 90%; max-width: 500px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        textarea { width: 100%; height: 150px; margin-bottom: 15px; padding: 15px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 6px; font-family: monospace; }
        .modal-btns { text-align: right; display: flex; gap: 10px; justify-content: flex-end; }

        @media (max-width: 600px) {
            .quiz-options { grid-template-columns: 1fr; }
            .controls { flex-direction: column; align-items: stretch; }
            .result-stats { flex-direction: column; gap: 10px; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>TOEIC 30å¤©å¯¦æˆ°ç‰¹è¨“ <span style="font-size:0.5em; background:var(--accent); color:white; padding:3px 8px; border-radius:4px; vertical-align:middle;">PRO</span></h1>
    
    <div class="tabs">
        <div class="tab active" onclick="switchTab('study')">ğŸ“– èƒŒå–®å­—</div>
        <div class="tab" onclick="switchTab('quiz')">âš”ï¸ å¯¦æˆ°æ¸¬é©—</div>
    </div>

    <div id="studySection" class="view-section active">
        <div class="controls">
            <label style="flex:1;">
                <div style="font-size:0.85em; color:#666; margin-bottom:5px;">é¸æ“‡é€²åº¦</div>
                <select id="daySelector" onchange="renderWords()" style="width:100%;"></select>
            </label>
            <button class="btn-primary" onclick="openImport()">+ åŒ¯å…¥</button>
        </div>
        <ul class="word-list" id="wordList"></ul>
    </div>

    <div id="quizSection" class="view-section">
        <div class="controls" id="quizStartScreen">
            <label style="flex:1;">
                <div style="font-size:0.85em; color:#666; margin-bottom:5px;">é¸æ“‡æ¸¬é©—ç¯„åœ</div>
                <select id="quizScopeSelector" style="width:100%;"></select>
            </label>
            <button class="btn-accent" onclick="startQuiz()">é–‹å§‹æ¸¬é©—</button>
        </div>

        <div id="quizArea" style="display:none;"></div>
        
        <div id="quizControls" style="display:none; text-align:center; margin-top:30px; padding-top:20px; border-top:1px dashed #ccc;">
            <button class="btn-accent" onclick="submitQuiz()" style="padding: 12px 50px; font-size:1.1em;">äº¤å· (Submit)</button>
        </div>

        <div id="quizResult" style="display:none;">
            <div class="result-stats">
                <div class="stat-card">
                    <div style="font-size:0.9em; color:#666;">ç¸½åˆ†</div>
                    <div class="stat-num" id="scoreBoard">0</div>
                </div>
                <div class="stat-card">
                    <div style="font-size:0.9em; color:#666;">ç­”å°é¡Œæ•¸</div>
                    <div class="stat-num" id="correctCount">0/0</div>
                </div>
            </div>
            <div id="resultList"></div>
            <div style="text-align:center; margin-top:30px;">
                <button class="btn-primary" onclick="resetQuiz()" style="width:100%;">å†ä¾†ä¸€æ¬¡</button>
            </div>
        </div>
    </div>
</div>

<div id="importModal">
    <div class="modal-content">
        <h3 style="margin-top:0;">åŒ¯å…¥ JSON è³‡æ–™</h3>
        <p style="font-size:0.9em; color:#666;">è«‹è²¼ä¸Š JSON (æ¬„ä½åŒ…å« w, m, pos, s, rel, ex, ch)ï¼š</p>
        <textarea id="importInput" placeholder='{"10": [{"w":"notice", "s":3, "rel":"[è¡] notify v. é€šçŸ¥", ...}]}'></textarea>
        <div class="modal-btns">
            <button style="background:#eee; color:#333;" onclick="closeImport()">å–æ¶ˆ</button>
            <button class="btn-accent" onclick="saveImport()">åŒ¯å…¥è³‡æ–™</button>
        </div>
    </div>
</div>

<script>
   // --- è³‡æ–™åº« (ç¶­æŒä½ çš„è³‡æ–™çµæ§‹) ---
    // w=å–®å­—, s=æ˜Ÿç´š, p=éŸ³æ¨™, pos=è©æ€§, m=å«ç¾©, rel=ç›¸é—œå­—, ex=ä¾‹å¥, ch=ä¸­è­¯
    let db = {
      "1": [
    {"w":"hire", "s":3, "p":"/haÉªr/", "pos":"v.", "m":"é›‡ç”¨", "rel":"[è¡] hiring n. é›‡ç”¨; [å] fire v. è§£åƒ±", "ex":"We aim to hire three new engineers.", "ch":"æˆ‘å€‘ç›®æ¨™æ˜¯é›‡ç”¨ä¸‰ä½æ–°å·¥ç¨‹å¸«ã€‚"},
    {"w":"recruit", "s":2, "p":"/rÉªËˆkrut/", "pos":"v.", "m":"æ‹›å‹Ÿ", "rel":"[è¡] recruitment n. æ‹›å‹Ÿ; recruiter n. æ‹›è˜äººå“¡", "ex":"The firm recruits from top universities.", "ch":"é€™é–“å…¬å¸å¾é ‚å°–å¤§å­¸æ‹›å‹Ÿäººæ‰ã€‚"},
    {"w":"employ", "s":3, "p":"/ÉªmËˆplÉ”Éª/", "pos":"v.", "m":"é›‡ç”¨", "rel":"[è¡] employer n. é›‡ä¸»; employee n. å“¡å·¥", "ex":"The factory employs 500 workers.", "ch":"é€™é–“å·¥å» é›‡ç”¨äº†500åå·¥äººã€‚"},
    {"w":"candidate", "s":3, "p":"/ËˆkÃ¦ndÉªËŒdeÉªt/", "pos":"n.", "m":"æ‡‰å¾µè€…ï¼›å€™é¸äºº", "rel":"[åŒ] applicant n. ç”³è«‹äºº", "ex":"He is the strongest candidate so far.", "ch":"ä»–æ˜¯ç›®å‰ç‚ºæ­¢æœ€å¼·çš„å€™é¸äººã€‚"},
    {"w":"applicant", "s":3, "p":"/ËˆÃ¦plÉªkÉ™nt/", "pos":"n.", "m":"ç”³è«‹äºº", "rel":"[è¡] apply v. ç”³è«‹", "ex":"Applicants must be over 18.", "ch":"ç”³è«‹äººå¿…é ˆå¹´æ»¿18æ­²ã€‚"},
    {"w":"resume", "s":3, "p":"/rÉªËˆzum/", "pos":"n.", "m":"å±¥æ­·è¡¨", "rel":"[åŒ] CV (curriculum vitae) n. ç°¡æ­·", "ex":"Please email your resume to HR.", "ch":"è«‹å°‡ä½ çš„å±¥æ­·è¡¨å¯„çµ¦äººè³‡ã€‚"},
    {"w":"interview", "s":3, "p":"/ËˆÉªntÉ™rËŒvju/", "pos":"n.", "m":"é¢è©¦", "rel":"[è¡] interviewer n. é¢è©¦å®˜", "ex":"My job interview is at 10 AM.", "ch":"æˆ‘çš„å·¥ä½œé¢è©¦åœ¨æ—©ä¸Š10é»ã€‚"},
    {"w":"position", "s":3, "p":"/pÉ™ËˆzÉªÊƒÉ™n/", "pos":"n.", "m":"è·ä½", "rel":"[åŒ] post, job", "ex":"The position has been filled.", "ch":"è©²è·ä½å·²æœ‰äººé¸ã€‚"},
    {"w":"opening", "s":2, "p":"/ËˆoÊŠpÉ™nÉªÅ‹/", "pos":"n.", "m":"è·ç¼ºï¼›ç©ºç¼º", "rel":"[åŒ] vacancy n. ç©ºç¼º", "ex":"There are several openings in sales.", "ch":"æ¥­å‹™éƒ¨æœ‰å¹¾å€‹è·ç¼ºã€‚"},
    {"w":"vacancy", "s":2, "p":"/ËˆveÉªkÉ™nsi/", "pos":"n.", "m":"ç©ºç¼ºï¼›ç©ºæˆ¿", "rel":"[è¡] vacant adj. ç©ºçš„", "ex":"We have a vacancy for a manager.", "ch":"æˆ‘å€‘æœ‰ä¸€å€‹ç¶“ç†çš„è·ç¼ºã€‚"},
    {"w":"qualify", "s":2, "p":"/ËˆkwÉ‘lÉ™ËŒfaÉª/", "pos":"v.", "m":"ç¬¦åˆè³‡æ ¼", "rel":"[è¡] qualified adj. åˆæ ¼çš„; qualification n. è³‡æ ¼", "ex":"He strictly qualifies for the job.", "ch":"ä»–å®Œå…¨ç¬¦åˆé€™ä»½å·¥ä½œçš„è³‡æ ¼ã€‚"},
    {"w":"recommend", "s":3, "p":"/ËŒrÉ›kÉ™ËˆmÉ›nd/", "pos":"v.", "m":"æ¨è–¦", "rel":"[è¡] recommendation n. æ¨è–¦ä¿¡", "ex":"Can you recommend a good lawyer?", "ch":"ä½ èƒ½æ¨è–¦ä¸€ä½å¥½å¾‹å¸«å—ï¼Ÿ"},
    {"w":"reference", "s":2, "p":"/ËˆrÉ›fÉ™rÉ™ns/", "pos":"n.", "m":"æ¨è–¦äººï¼›åƒè€ƒ", "rel":"[ç‰‡] reference letter æ¨è–¦ä¿¡", "ex":"Please provide three references.", "ch":"è«‹æä¾›ä¸‰ä½æ¨è–¦äººã€‚"},
    {"w":"human resources", "s":3, "p":"/ËŒhjumÉ™n ËˆrisÉ”rsÉªz/", "pos":"n.", "m":"äººåŠ›è³‡æº(éƒ¨)", "rel":"[ç¸®] HR", "ex":"Contact Human Resources for details.", "ch":"è©³æƒ…è«‹è¯ç¹«äººåŠ›è³‡æºéƒ¨ã€‚"},
    {"w":"staff", "s":3, "p":"/stÃ¦f/", "pos":"n.", "m":"å…¨é«”å“¡å·¥", "rel":"[åŒ] personnel n. äººå“¡", "ex":"We have a staff of 50 people.", "ch":"æˆ‘å€‘æœ‰50åå“¡å·¥ã€‚"},
    {"w":"personnel", "s":2, "p":"/ËŒpÉœrsÉ™ËˆnÉ›l/", "pos":"n.", "m":"äººå“¡ï¼›äººäº‹éƒ¨é–€", "rel":"[åŒ] staff n. å“¡å·¥", "ex":"All personnel must sign in.", "ch":"æ‰€æœ‰äººå“¡éƒ½å¿…é ˆç°½åˆ°ã€‚"},
    {"w":"career", "s":3, "p":"/kÉ™ËˆrÉªr/", "pos":"n.", "m":"è·æ¶¯ï¼›äº‹æ¥­", "rel":"[ç‰‡] pursue a career è¿½æ±‚äº‹æ¥­", "ex":"She wants a career in fashion.", "ch":"å¥¹æƒ³è¦å¾äº‹æ™‚å°šæ¥­ã€‚"},
    {"w":"occupation", "s":2, "p":"/ËŒÉ‘kjÉ™ËˆpeÉªÊƒÉ™n/", "pos":"n.", "m":"è·æ¥­", "rel":"[åŒ] job, profession", "ex":"State your name and occupation.", "ch":"èªªæ˜ä½ çš„å§“åå’Œè·æ¥­ã€‚"},
    {"w":"profession", "s":2, "p":"/prÉ™ËˆfÉ›ÊƒÉ™n/", "pos":"n.", "m":"(å°ˆæ¥­)è·æ¥­", "rel":"[è¡] professional adj. å°ˆæ¥­çš„", "ex":"Teaching is a noble profession.", "ch":"æ•™æ›¸æ˜¯é«˜å°šçš„è·æ¥­ã€‚"},
    {"w":"unemployment", "s":2, "p":"/ËŒÊŒnÉªmËˆplÉ”ÉªmÉ™nt/", "pos":"n.", "m":"å¤±æ¥­", "rel":"[è¡] unemployed adj. å¤±æ¥­çš„", "ex":"Unemployment is rising.", "ch":"å¤±æ¥­ç‡æ­£åœ¨ä¸Šå‡ã€‚"},
    {"w":"layoff", "s":2, "p":"/ËˆleÉªËŒÉ”f/", "pos":"n.", "m":"è§£åƒ±ï¼›è£å“¡", "rel":"[è¡] lay off v. è£å“¡", "ex":"The company announced huge layoffs.", "ch":"å…¬å¸å®£å¸ƒå¤§è¦æ¨¡è£å“¡ã€‚"},
    {"w":"temporary", "s":2, "p":"/ËˆtÉ›mpÉ™ËŒrÉ›ri/", "pos":"adj.", "m":"æš«æ™‚çš„ï¼›è‡¨æ™‚çš„", "rel":"[å] permanent adj. æ°¸ä¹…çš„", "ex":"It's just a temporary job.", "ch":"é€™åªæ˜¯ä»½è‡¨æ™‚å·¥ä½œã€‚"},
    {"w":"short-term", "s":2, "p":"/ÊƒÉ”rt tÉœrm/", "pos":"adj.", "m":"çŸ­æœŸçš„", "rel":"[å] long-term é•·æœŸçš„", "ex":"They hired him on a short-term contract.", "ch":"ä»–å€‘ç°½çŸ­æœŸåˆç´„é›‡ç”¨ä»–ã€‚"},
    {"w":"expert", "s":2, "p":"/ËˆÉ›kspÉœrt/", "pos":"n.", "m":"å°ˆå®¶", "rel":"[è¡] expertise n. å°ˆæ¥­çŸ¥è­˜", "ex":"He is an expert in IT.", "ch":"ä»–æ˜¯ITæ–¹é¢çš„å°ˆå®¶ã€‚"},
    {"w":"ability", "s":3, "p":"/É™ËˆbÉªlÉ™ti/", "pos":"n.", "m":"èƒ½åŠ›", "rel":"[åŒ] capability n. èƒ½åŠ›", "ex":"She has the ability to manage.", "ch":"å¥¹æœ‰ç®¡ç†çš„èƒ½åŠ›ã€‚"},
    {"w":"skill", "s":3, "p":"/skÉªl/", "pos":"n.", "m":"æŠ€èƒ½", "rel":"[è¡] skilled adj. ç†Ÿç·´çš„", "ex":"Computer skills are essential.", "ch":"é›»è…¦æŠ€èƒ½æ˜¯å¿…è¦çš„ã€‚"},
    {"w":"training", "s":3, "p":"/ËˆtreÉªnÉªÅ‹/", "pos":"n.", "m":"è¨“ç·´", "rel":"[è¡] train v. è¨“ç·´", "ex":"The training lasts three days.", "ch":"è¨“ç·´æŒçºŒä¸‰å¤©ã€‚"},
    {"w":"background", "s":3, "p":"/ËˆbÃ¦kËŒgraÊŠnd/", "pos":"n.", "m":"èƒŒæ™¯ï¼›ç¶“æ­·", "rel":"[ç‰‡] educational background å­¸æ­·", "ex":"He has a background in science.", "ch":"ä»–æœ‰ç§‘å­¸èƒŒæ™¯ã€‚"},
    {"w":"degree", "s":2, "p":"/dÉªËˆgri/", "pos":"n.", "m":"å­¸ä½", "rel":"[ç‰‡] master's degree ç¢©å£«å­¸ä½", "ex":"She has a degree in law.", "ch":"å¥¹æœ‰æ³•å¾‹å­¸ä½ã€‚"},
    {"w":"certificate", "s":2, "p":"/sÉ™rËˆtÉªfÉªkÉ™t/", "pos":"n.", "m":"è­‰æ›¸ï¼›åŸ·ç…§", "rel":"[è¡] certification n. èªè­‰", "ex":"Do you have a teaching certificate?", "ch":"ä½ æœ‰æ•™å¸«è­‰å—ï¼Ÿ"},
    {"w":"submit", "s":3, "p":"/sÉ™bËˆmÉªt/", "pos":"v.", "m":"æäº¤", "rel":"[è¡] submission n. æäº¤", "ex":"Submit your report by 5 PM.", "ch":"è«‹åœ¨ä¸‹åˆ5é»å‰æäº¤å ±å‘Šã€‚"},
    {"w":"application", "s":3, "p":"/ËŒÃ¦plÉ™ËˆkeÉªÊƒÉ™n/", "pos":"n.", "m":"ç”³è«‹æ›¸ï¼›æ‡‰ç”¨", "rel":"[ç‰‡] fill out an application å¡«å¯«ç”³è«‹è¡¨", "ex":"The application deadline is Monday.", "ch":"ç”³è«‹æˆªæ­¢æ—¥æœŸæ˜¯é€±ä¸€ã€‚"},
    {"w":"requirement", "s":2, "p":"/rÉªËˆkwaÉªrmÉ™nt/", "pos":"n.", "m":"å¿…è¦æ¢ä»¶", "rel":"[è¡] require v. éœ€è¦", "ex":"Experience is a key requirement.", "ch":"ç¶“é©—æ˜¯é—œéµè¦æ±‚ã€‚"},
    {"w":"eligible", "s":1, "p":"/ËˆÉ›lÉªdÊ’É™bÉ™l/", "pos":"adj.", "m":"æœ‰è³‡æ ¼çš„", "rel":"[è¡] eligibility n. è³‡æ ¼", "ex":"You are eligible for a bonus.", "ch":"ä½ æœ‰è³‡æ ¼ç²å¾—çé‡‘ã€‚"},
    {"w":"proficiency", "s":1, "p":"/prÉ™ËˆfÉªÊƒÉ™nsi/", "pos":"n.", "m":"ç†Ÿç·´ï¼›ç²¾é€š", "rel":"[è¡] proficient adj. ç²¾é€šçš„", "ex":"The job requires high proficiency in English.", "ch":"é€™ä»½å·¥ä½œè¦æ±‚é«˜åº¦çš„è‹±èªç†Ÿç·´åº¦ã€‚"},
    {"w":"cover letter", "s":2, "p":"/ËˆkÊŒvÉ™r ËŒlÉ›tÉ™r/", "pos":"n.", "m":"æ±‚è·ä¿¡", "rel":"[ç‰‡] attach a cover letter é™„ä¸Šæ±‚è·ä¿¡", "ex":"Attach a cover letter to your resume.", "ch":"åœ¨å±¥æ­·ä¸Šé™„ä¸Šä¸€å°æ±‚è·ä¿¡ã€‚"},
    {"w":"manager", "s":3, "p":"/ËˆmÃ¦nÉ™dÊ’É™r/", "pos":"n.", "m":"ç¶“ç†", "rel":"[è¡] manage v. ç®¡ç†", "ex":"The manager will interview you.", "ch":"ç¶“ç†æœƒé¢è©¦ä½ ã€‚"},
    {"w":"achievement", "s":2, "p":"/É™ËˆtÊƒivmÉ™nt/", "pos":"n.", "m":"æˆå°±", "rel":"[è¡] achieve v. é”æˆ", "ex":"List your achievements on the resume.", "ch":"åœ¨å±¥æ­·ä¸Šåˆ—å‡ºä½ çš„æˆå°±ã€‚"},
    {"w":"experience", "s":3, "p":"/ÉªkËˆspÉªriÉ™ns/", "pos":"n.", "m":"ç¶“é©—", "rel":"[è¡] experienced adj. æœ‰ç¶“é©—çš„", "ex":"She has 5 years of experience.", "ch":"å¥¹æœ‰5å¹´çš„ç¶“é©—ã€‚"},
    {"w":"full-time", "s":3, "p":"/ËŒfÊŠl ËˆtaÉªm/", "pos":"adj.", "m":"å…¨è·çš„", "rel":"[å] part-time å…¼è·çš„", "ex":"It is a full-time position.", "ch":"é€™æ˜¯ä¸€ä»½å…¨è·å·¥ä½œã€‚"}
  ]
    };

    // å¯ä»¥åœ¨é€™è£¡å®šç¾©ä¸»é¡Œåç¨±ï¼Œè‹¥ç„¡å®šç¾©å‰‡é¡¯ç¤º Day X
   const themes = {
        "1": "Day 01: æ“ºè„«å¤±æ¥­ (é›‡ç”¨/é¢è©¦)",
        "2": "Day 02: å±•ç¾èƒ½åŠ› (å·¥ä½œå…§å®¹)",
        "3": "Day 03: è«‡è–ªæ°´ç¦åˆ© (è–ªè³‡/ä¼‘å‡)",
        "4": "Day 04: è¾¦å…¬å®¤äººéš› (åœ˜éšŠ/å‡é·)",
        "5": "Day 05: ç°½ç´„å…¥è· (åˆç´„/è¦å®š)",
        "6": "Day 06: æœè£è¦å®š (æœé£¾)",
        "7": "Day 07: éŠ·å”®ç­–ç•¥ (è¡ŒéŠ· 1)",
        "8": "Day 08: åœ‹éš›è¡ŒéŠ· (è¡ŒéŠ· 2)",
        "9": "Day 09: æŒ½æ•‘ç¶“æ¿Ÿ (ç¶“æ¿Ÿ)",
        "10": "Day 10: è³¼ç‰©é«˜æ‰‹ (è³¼ç‰©)",
        "11": "Day 11: æ–°ç”¢å“ä¸Šå¸‚ (ç”¢å“é–‹ç™¼)",
        "12": "Day 12: å·¥å» è‡ªå‹•åŒ– (ç”Ÿç”¢)",
        "13": "Day 13: é¡§å®¢è‡³ä¸Š (é¡§å®¢æœå‹™)",
        "14": "Day 14: å‡ºå·®çš„ç›®çš„ (æ—…éŠ/æ©Ÿå ´)",
        "15": "Day 15: è²¿æ˜“å”å®š (å•†æ¥­)",
        "16": "Day 16: é™æ™‚é…é€ (è²¿æ˜“/è²¨é‹)",
        "17": "Day 17: ç‰¹åˆ¥æ–™ç† (ä½å®¿/é¤å»³)",
        "18": "Day 18: ç¯€çœç¶“è²» (æœƒè¨ˆ)",
        "19": "Day 19: è¾¦å…¬å®¤æ°£æ°› (å…¬å¸å‹•å‘)",
        "20": "Day 20: ç·Šæ€¥æœƒè­° (æœƒè­°)",
        "21": "Day 21: é–‹è»Š (äº¤é€š)",
        "22": "Day 22: å­˜æ¬¾èˆ‡ç›¡å­ (éŠ€è¡Œ)",
        "23": "Day 23: å‹æƒ…èˆ‡æŠ•è³‡ (æŠ•è³‡)",
        "24": "Day 24: å¤å…¸é¢¨å‘³ (å»ºç¯‰/ä½å®…)",
        "25": "Day 25: å¤©æ°£é å ± (ç’°å¢ƒ)",
        "26": "Day 26: é‡å¤§ç–¾ç—… (å¥åº·)",
        "27": "Day 27: ç¤¾äº¤æ´»å‹• (å¨›æ¨‚/æ–‡åŒ–)",
        "28": "Day 28: ç§‘æŠ€è¶¨å‹¢ (é›»è…¦/ç¶²è·¯)",
        "29": "Day 29: æ³•å¾‹äº‹å‹™ (æ³•å¾‹)",
        "30": "Day 30: å…¬å…±å»ºè¨­ (ç¤¾æœƒ/æ”¿åºœ)"
    };

    const daySelector = document.getElementById('daySelector');
    const wordList = document.getElementById('wordList');
    const quizScopeSelector = document.getElementById('quizScopeSelector');
    const importModal = document.getElementById('importModal');
    const importInput = document.getElementById('importInput');

    let currentQuizQuestions = [];
    let userAnswers = {};

    function init() {
        // å˜—è©¦è®€å–èˆŠè³‡æ–™ (ç›¸å®¹ V2/V3)
        const savedData = localStorage.getItem('toeicProV3') || localStorage.getItem('toeicProV2');
        if (savedData) {
            try { db = { ...db, ...JSON.parse(savedData) }; } catch(e){}
        }
        updateMenus();
        
        // é è¨­é¸æ“‡ç¬¬ä¸€ç­†è³‡æ–™
        const firstDay = Object.keys(db).sort((a,b)=>Number(a)-Number(b))[0];
        if(firstDay) daySelector.value = firstDay;
        renderWords();
    }

    // â˜… ä¿®æ”¹é»ï¼šå„ªåŒ–é¸å–®é‚è¼¯ (å–®æ—¥ / 5æ—¥ / å…¨éƒ¨)
    function updateMenus() {
        // 1. æ›´æ–°èƒŒå–®å­—é¸å–® (ç¶­æŒå–®æ—¥é¸æ“‡)
        daySelector.innerHTML = "";
        const days = Object.keys(db).map(Number).sort((a,b)=>a-b);
        
        days.forEach(i => {
            let label = themes[i] || `Day ${i}`;
            daySelector.add(new Option(label, i));
        });

        // 2. æ›´æ–°æ¸¬é©—é¸å–® (åˆ†çµ„é¡¯ç¤º)
        quizScopeSelector.innerHTML = "";

        // Group A: å–®æ—¥æ¸¬é©—
        const groupSingle = document.createElement('optgroup');
        groupSingle.label = "ğŸ“‹ å–®æ—¥æ¸¬é©— (One Day)";
        days.forEach(d => {
            let label = themes[d] ? themes[d].split(":")[0] : `Day ${d}`;
            groupSingle.appendChild(new Option(label, d));
        });
        quizScopeSelector.add(groupSingle);

        // Group B: 5å¤©å€é–“æ¸¬é©— (1-5, 6-10...)
        const groupRange = document.createElement('optgroup');
        groupRange.label = "ğŸ“… éšæ®µè¤‡ç¿’ (5 Days)";
        
        // æƒæ 1~30 å¤© (å‡è¨­TOEICæ›¸é€šå¸¸30å¤©)
        for (let start = 1; start <= 30; start += 5) {
            let end = start + 4;
            // æª¢æŸ¥é€™å€é–“å…§æœ‰æ²’æœ‰ä»»ä½•åŒ¯å…¥çš„è³‡æ–™
            let hasData = days.some(d => d >= start && d <= end);
            
            if (hasData) {
                // é¡¯ç¤ºæ¨™ç±¤ï¼Œä¾‹å¦‚ "Day 1 - 5", "Day 6 - 10"
                groupRange.appendChild(new Option(`Day ${start} - ${end}`, `${start}-${end}`));
            }
        }
        // å¦‚æœæœ‰ç”¢ç”Ÿå€é–“é¸é …ï¼Œæ‰åŠ å…¥é€™å€‹ç¾¤çµ„
        if (groupRange.children.length > 0) {
            quizScopeSelector.add(groupRange);
        }

        // Group C: ç¸½è¤‡ç¿’
        const groupAll = document.createElement('optgroup');
        groupAll.label = "ğŸ† çµ‚æ¥µæŒ‘æˆ°";
        groupAll.appendChild(new Option("å…¨ç¯„åœç¸½è¤‡ç¿’ (All)", "all"));
        quizScopeSelector.add(groupAll);
    }

    function switchTab(tab) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
        
        if (tab === 'study') {
            document.querySelector('.tab:nth-child(1)').classList.add('active');
            document.getElementById('studySection').classList.add('active');
        } else {
            document.querySelector('.tab:nth-child(2)').classList.add('active');
            document.getElementById('quizSection').classList.add('active');
        }
    }

    function playAudio(text) {
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'en-US';
        utterance.rate = 0.8;
        window.speechSynthesis.speak(utterance);
    }

    function getStars(level) {
        if (!level) return '<span class="stars">â˜…â˜…â˜…</span>';
        let starStr = level >= 3 ? "â˜…â˜…â˜…" : (level === 2 ? "â˜…â˜…" : "â˜…");
        return `<span class="stars">${starStr}</span>`;
    }

    function renderWords() {
        const day = daySelector.value;
        wordList.innerHTML = "";
        
        if (!db[day]) {
            wordList.innerHTML = `<li style="padding:20px; text-align:center; color:#999;">æœ¬æ—¥å°šç„¡å–®å­—è³‡æ–™ã€‚</li>`;
            return;
        }

        db[day].forEach((item, index) => {
            const li = document.createElement('li');
            li.className = 'word-item';
            
            let relHtml = item.rel ? `<div class="word-rel">${item.rel}</div>` : "";

            li.innerHTML = `
                <div class="word-header">
                    <span class="index-num">${index+1}.</span>
                    <span class="en-word">${item.w}</span>
                    <button class="btn-audio" onclick="playAudio('${item.w}')">ğŸ”Š</button>
                    <span class="pos-tag">${item.pos}</span>
                    ${getStars(item.s)}
                    <span class="ch-meaning">${item.m}</span>
                </div>
                ${relHtml}
                <div class="sentence-box">
                    <span class="en-sent">${item.ex}</span>
                    <span style="font-size:0.9em; color:#888;">${item.ch}</span>
                </div>
            `;
            wordList.appendChild(li);
        });
    }

    // --- â˜… ä¿®æ”¹é»ï¼šæ¸¬é©—ç¯„åœé‚è¼¯ ---
    function startQuiz() {
        const scope = quizScopeSelector.value;
        let pool = [];

        // 1. è™•ç† "All"
        if (scope === 'all') {
            Object.values(db).forEach(d => pool = pool.concat(d));
        } 
        // 2. è™•ç† "ç¯„åœ" (ä¾‹å¦‚ "1-5", "6-10")
        else if (scope.includes("-")) {
            const [start, end] = scope.split("-").map(Number);
            // æŠŠç¯„åœå…§æ¯ä¸€å¤©çš„å–®å­—éƒ½åŠ é€²ä¾†
            for (let i = start; i <= end; i++) {
                if (db[i]) {
                    pool = pool.concat(db[i]);
                }
            }
        } 
        // 3. è™•ç† "å–®æ—¥"
        else {
            if (db[scope]) pool = db[scope];
        }

        if (pool.length < 4) {
            alert("æ‰€é¸ç¯„åœå–®å­—é‡å¤ªå°‘ (è‡³å°‘éœ€4å€‹)ï¼Œè«‹é¸æ“‡å…¶ä»–ç¯„åœæˆ–åŒ¯å…¥æ›´å¤šå–®å­—ã€‚");
            return;
        }

        // é¡Œç›®æ•¸é‡ï¼šæœ€å¤šå‡º 15 é¡Œ (é¿å…ä¸€æ¬¡åšå¤ªä¹…)
        const questionCount = Math.min(pool.length, 15);
        const selectedWords = shuffle(pool).slice(0, questionCount);
        
        currentQuizQuestions = selectedWords.map(word => generateSmartQuestion(word, pool));
        userAnswers = {};

        // UI åˆ‡æ›
        document.getElementById('quizStartScreen').style.display = 'none';
        document.getElementById('quizArea').style.display = 'block';
        document.getElementById('quizControls').style.display = 'block';
        document.getElementById('quizResult').style.display = 'none';

        renderQuizQuestions();
        window.scrollTo(0,0);
    }

    function generateSmartQuestion(target, fullPool) {
        const mode = Math.random() > 0.4 ? 'sentence' : 'meaning';
        const targetPos = target.pos.split('.')[0].trim().toLowerCase(); 
        
        // æ‰¾åŒè©æ€§çš„å¹²æ“¾é …
        let samePosWords = fullPool.filter(w => w.w !== target.w && w.pos.toLowerCase().includes(targetPos));
        let distractors = [];

        if (samePosWords.length >= 3) {
            distractors = shuffle(samePosWords).slice(0, 3);
        } else {
            let otherWords = fullPool.filter(w => w.w !== target.w);
            distractors = shuffle(otherWords).slice(0, 3);
        }

        let questionText = "";
        let displayOptions = shuffle([target.w, ...distractors.map(d => d.w)]);

        if (mode === 'sentence') {
            // ç”¨åº•ç·šå–ä»£å–®å­—åŠå…¶è®ŠåŒ–å½¢
            const regex = new RegExp(target.w + "(ing|ed|s|d|es|ly)?", "gi");
            questionText = target.ex.replace(regex, "_______");
        } else {
            questionText = `ä¸‹åˆ—å“ªå€‹å–®å­—çš„æ„æ€æ˜¯ï¼š<br><span style="color:#c0392b; font-size:1.3em;">ã€Œ${target.m}ã€</span>ï¼Ÿ`;
        }

        return {
            mode: mode,
            q: questionText,
            correct: target.w,
            options: displayOptions,
            data: target
        };
    }

    function renderQuizQuestions() {
        const area = document.getElementById('quizArea');
        area.innerHTML = "";
        const markers = ['A', 'B', 'C', 'D'];

        currentQuizQuestions.forEach((q, index) => {
            const div = document.createElement('div');
            div.className = 'quiz-card';
            const tagLabel = q.mode === 'sentence' ? 'æ–‡æ³•èˆ‡èªå¢ƒ' : 'å–®å­—é‡‹ç¾©';

            div.innerHTML = `
                <div class="quiz-tag">${tagLabel}</div>
                <div class="quiz-question">${index+1}. ${q.q}</div>
                <div class="quiz-options">
                    ${q.options.map((opt, i) => `
                        <div class="option-btn" onclick="selectOption(${index}, '${opt}', this)">
                            <span class="option-marker">${markers[i]}.</span> ${opt}
                        </div>
                    `).join('')}
                </div>
            `;
            area.appendChild(div);
        });
    }

    function selectOption(qIndex, answer, element) {
        userAnswers[qIndex] = answer;
        const parent = element.parentElement;
        parent.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
        element.classList.add('selected');
    }

    function submitQuiz() {
        if (Object.keys(userAnswers).length < currentQuizQuestions.length) {
            if(!confirm("é‚„æœ‰é¡Œç›®æ²’å¯«å®Œï¼Œç¢ºå®šè¦äº¤å·å—ï¼Ÿ")) return;
        }

        let score = 0;
        let html = "";

        currentQuizQuestions.forEach((q, index) => {
            const userAns = userAnswers[index];
            const isCorrect = (userAns === q.correct);
            if(isCorrect) score++;

            html += `
                <div class="result-item ${isCorrect ? 'correct' : 'wrong'}">
                    <div style="font-weight:bold; margin-bottom:5px;">Q${index+1}</div>
                    <div style="margin-bottom:10px;">${q.q}</div>
                    
                    <div class="answer-row">
                        <span>ä½ çš„é¸æ“‡: <b style="color:${isCorrect?'green':'red'}">${userAns || "æœªä½œç­”"}</b></span>
                        ${!isCorrect ? `<span>æ­£è§£: <b style="color:green">${q.correct}</b></span>` : ''}
                    </div>

                    <div class="explanation">
                        <strong>ğŸ’¡ å–®å­—è§£æï¼š</strong>
                        <span style="color:#2980b9; font-weight:bold;">${q.data.w}</span> 
                        <span style="background:#eee; padding:0 4px; font-size:0.8em;">${q.data.pos}</span> 
                        ${getStars(q.data.s)}
                        ${q.data.m}<br>
                        ${q.data.rel ? `<span style="font-size:0.9em; color:#666; background:#f1f2f6; padding:2px 5px; border-radius:3px;">${q.data.rel}</span><br>` : ''}
                        <em>ä¾‹å¥ï¼š${q.data.ex}</em>
                    </div>
                </div>
            `;
        });

        const finalScore = Math.round((score / currentQuizQuestions.length) * 100);
        document.getElementById('scoreBoard').innerText = finalScore;
        document.getElementById('correctCount').innerText = `${score} / ${currentQuizQuestions.length}`;
        document.getElementById('resultList').innerHTML = html;

        document.getElementById('quizArea').style.display = 'none';
        document.getElementById('quizControls').style.display = 'none';
        document.getElementById('quizResult').style.display = 'block';
        window.scrollTo(0,0);
    }

    function resetQuiz() {
        document.getElementById('quizStartScreen').style.display = 'flex';
        document.getElementById('quizResult').style.display = 'none';
    }

    function shuffle(array) {
        let currentIndex = array.length, randomIndex;
        const newArr = [...array];
        while (currentIndex != 0) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;
            [newArr[currentIndex], newArr[randomIndex]] = [newArr[randomIndex], newArr[currentIndex]];
        }
        return newArr;
    }

    function openImport() { importModal.style.display = "flex"; importInput.value = ""; }
    function closeImport() { importModal.style.display = "none"; }
    function saveImport() {
        try {
            const raw = importInput.value;
            if (!raw.trim()) return;
            const newData = JSON.parse(raw);
            db = { ...db, ...newData };
            localStorage.setItem('toeicProV3', JSON.stringify(db));
            alert("åŒ¯å…¥æˆåŠŸï¼");
            updateMenus();
            closeImport();
        } catch (e) { alert("JSON æ ¼å¼éŒ¯èª¤"); }
    }

    // å•Ÿå‹•åˆå§‹åŒ–
    init();
</script>

</body>

</html>
